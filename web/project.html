<!DOCTYPE html>
<html lang="en">
  <head>
    <title>webproject</title>
    <script src="https://kit.fontawesome.com/706c4bc499.js" crossorigin="anonymous"></script>
    <script>
      function addZero(a) {
        if (a < 10) {
          a = `0${a}`;
        } else {
          a = a.toString();
        }
        return a;
      }

      function setClock() {
        let newTime = new Date();
        let hour = newTime.getHours();
        let min = newTime.getMinutes();
        let sec = newTime.getSeconds();
        if (hour > 12) {
          hour -= 12;
          document.getElementById("am").innerHTML = "PM";
        } else if (hour == 0) {
          hour = 12;
          
          document.getElementById("am").innerHTML = "AM";
        } else {
          document.getElementById("am").innerHTML = "AM";
        }
        document.getElementById("time").innerHTML = `${addZero(hour)}:${addZero(
          min
        )}`;
        document.getElementById("sec").innerHTML = addZero(sec);
      }

      async function getWeather(lat, lng, isAllowed) {
        const key = "e89d6cbebe4567f9679d37643de972fd";
        const city = "Seoul";
        const data = [];
        let url;

        try {
          if (isAllowed) {
            url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=${key}`;
          } else {
            url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${key}`;
          }

          const weatherResponse = await fetch(url);
          const weatherJson = await weatherResponse.json();

          data.push(weatherJson);

          document.getElementById("temp").innerHTML = Math.round(data[0].main.temp - 273.15);
          document.getElementById("c").innerHTML = "°C";

          if (data[0].weather[0].main == "Thunderstorm") {
            document.getElementById("conditionIcon").innerHTML = '<i class="fa-solid fa-bolt-lightning"></i>';
          } else if (data[0].weather[0].main == "Drizzle") {
            document.getElementById("conditionIcon").innerHTML = '<i class="fa-solid fa-cloud-showers-heavy"></i>';
          } else if (data[0].weather[0].main == "Rain") {
            document.getElementById("conditionIcon").innerHTML = '<i class="fa-solid fa-umbrella"></i>';
          } else if (data[0].weather[0].main == "Snow") {
            document.getElementById("conditionIcon").innerHTML = '<i class="fa-solid fa-snowflake"></i>';
          } else if (data[0].weather[0].main == "Clear") {
            document.getElementById("conditionIcon").innerHTML = '<i class="fa-solid fa-sun"></i>';
          } else if (data[0].weather[0].main == "Clouds") {
            document.getElementById("conditionIcon").innerHTML = '<i class="fa-solid fa-cloud"></i>';
          } else if (data[0].weather[0].main == "Haze") {
            document.getElementById("conditionIcon").innerHTML = '<i class="fa-solid fa-smog"></i>';
          } else if (data[0].weather[0].main == "Mist") {
            document.getElementById("conditionIcon").innerHTML = '<i class="fa-solid fa-smog"></i>';
          }
          return data;
        } catch (error) {
          console.error(error.message);
        }
      }

      async function userLocation(position) {
        let userLat = position.coords.latitude;
        let userLng = position.coords.longitude;
        await getWeather(userLat, userLng, true);
      }

      async function unallowed() {
        await getWeather(null, null, false);
      }
      unallowed();
      
      window.onload = function () {
        setClock(); //시계 호출
        setInterval(setClock, 100); //0.1초마다 시계호출
        navigator.geolocation.getCurrentPosition(userLocation); //유저 위치정보 허가 메세지 보내고 허용시 좌표받기 함수 호출
      };
    </script>
    <link rel="stylesheet" href="webproject.css" />
  </head>
  <body onselectstart="return false" ondragstart="return false" oncontextmenu="return false">
    <div id="container">
      <nav>
        <div id="menu">
          <div id="menuIcon" onclick=""><i class="fa-solid fa-bars"></i></div>
          <div id="menuDetail">
            
          </div>
        </div>
        <div id="weather">
          <div id="weatherContainer">
            <div id="temp"></div>
            <div id="c"></div>
          </div>
          <div id="conditionIcon"></div>
        </div>
      </nav>
      <div id="clock">
        <div id="timeHorizontal">
          <div id="time"></div>
          <div id="timeVertical">
            <div id="am"></div>
            <div id="sec"></div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
